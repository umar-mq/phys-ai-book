import Personalization from '@site/src/components/Personalization';
import Quiz from '@site/src/components/Quiz';

# 1.7 Defining the Body: URDF & Xacro

<Personalization level="novice" language="english">

## How to Describe a Robot to a Computer

**The URDF (Unified Robot Description Format)**

We have the software (Nodes) and the communication (Topics). Now we need the **Body**.
The computer doesn't know what your robot looks like. Is it a car? A dog? A humanoid?
We use a file format called **URDF** (Unified Robot Description Format) to tell ROS:
1.  **Links**: The solid parts (e.g., the thigh bone, the shin bone).
2.  **Joints**: The moving parts connecting links (e.g., the knee).

**Visual vs. Collision**
For every part of the robot, we define two shapes:
*   **Visual**: What it looks like (Pretty). High detail. "A shiny metal leg with screws and logos."
*   **Collision**: What physics uses (Fast). Low detail. "A simple cylinder."
*   *Why?* Calculating collisions for a complex 3D shape is too slow. We cheat by using simple shapes for physics.

### Writing Your First URDF

Create a folder `urdf` inside your package. Create a file `my_robot.urdf`.

```xml
<?xml version="1.0"?>
<robot name="simple_bot">

  <!-- Base Link (The Body) -->
  <link name="base_link">
    <visual>
      <geometry>
        <box size="0.6 0.4 0.2"/>
      </geometry>
      <material name="blue">
        <color rgba="0 0 0.8 1"/>
      </material>
    </visual>
    <collision>
      <geometry>
        <box size="0.6 0.4 0.2"/>
      </geometry>
    </collision>
  </link>

  <!-- A Wheel Link -->
  <link name="right_wheel">
    <visual>
      <geometry>
        <cylinder length="0.05" radius="0.1"/>
      </geometry>
    </visual>
    <collision>
      <geometry>
        <cylinder length="0.05" radius="0.1"/>
      </geometry>
    </collision>
  </link>

  <!-- The Joint connecting them -->
  <joint name="base_to_right_wheel" type="continuous">
    <parent link="base_link"/>
    <child link="right_wheel"/>
    <origin xyz="0 -0.22 0" rpy="1.57 0 0"/> <!-- Position and Rotation -->
    <axis xyz="0 0 1"/> <!-- Axis of rotation -->
  </joint>

</robot>
```

### Xacro (Making it Easier)

Writing URDF is repetitive. If your robot has 4 wheels, you copy-paste the wheel code 4 times.
**Xacro** is a "macro" language. It lets you write Python-like code inside XML.

```xml
<xacro:macro name="wheel" params="prefix location">
    <link name="${prefix}_wheel">
        ...
    </link>
    <joint name="base_to_${prefix}_wheel" ... >
        <origin xyz="0 ${location} 0" ... />
    </joint>
</xacro:macro>

<!-- Use the macro -->
<xacro:wheel prefix="right" location="-0.22"/>
<xacro:wheel prefix="left" location="0.22"/>
```
This keeps your code clean and manageable.

</Personalization>

<Personalization level="expert" language="english">

## Advanced Kinematics Modeling & Inertial Matrices

**Accurate Physics Simulation Requires Accurate Inertia**

For a "Digital Twin" to be useful, it must fall over exactly when the real robot falls over.
Most beginners ignore the `<inertial>` tag. **Do not do this.**
The physics engine (PhysX/Bullet) solves the equation $F = ma$ and $\tau = I\alpha$.
If you define a Link as a box but give it no mass or inertia, the simulation is garbage.

### 1. The Inertia Tensor
For every link, you must define the Mass ($m$) and the Inertia Matrix ($I_{xx}, I_{yy}, I_{zz}, I_{xy}, \dots$).

```xml
<inertial>
  <mass value="5.0"/> <!-- kg -->
  <origin xyz="0 0 0"/>
  <inertia ixx="0.1" ixy="0.0" ixz="0.0" 
           iyy="0.1" iyz="0.0" 
           izz="0.1"/>
</inertial>
```

*   **Tip**: For complex CAD meshes, do not guess these numbers. Use a tool like MeshLab or SolidWorks to calculate the Center of Mass (COM) and Inertia Tensor, then export to URDF.
*   **Instability**: If you give a tiny object a huge mass (or vice versa), the physics solver becomes unstable (the robot will vibrate or explode into space).

### 2. Joint Limits & Dynamics
For a Humanoid, joints are not perfect.
*   **Effort**: Max torque (Nm) the motor can apply.
*   **Velocity**: Max speed (rad/s).
*   **Damping**: Friction in the joint (air resistance/grease).
*   **Friction**: Static friction (stiction).

```xml
<joint name="knee_joint" type="revolute">
  <limit lower="-0.1" upper="1.57" effort="30.0" velocity="5.0"/>
  <dynamics damping="0.5" friction="0.1"/>
</joint>
```
If you omit damping, your simulated robot will swing its legs forever like a pendulum in a vacuum.

### 3. Mesh Optimization
Do not use raw 50MB `.STL` files from the mechanical team for collision checking.
*   **Visual**: Use high-poly `.DAE` (Collada) files with textures.
*   **Collision**: Use simplified `.STL` hulls (Convex Hulls).
*   **Performance**: If you use a high-poly mesh for collision, Isaac Sim's frame rate will drop to 5 FPS.

</Personalization>

<Personalization level="novice" language="urdu">

## Robot Ko Describe Karna: URDF

**Computer Ko Robot Kaise Dikhayein?**

Humaray paas dimagh (Nodes) hai aur bol chal (Topics) hai. Ab humein **Jism (Body)** chahiye.
Computer ko nahi pata ke aap ka robot kaisa dikhta hai. Kya ye gaari hai? Ya insaan numa?
Hum **URDF** (Unified Robot Description Format) file use karte hain taake ROS ko bata sakein:
1.  **Links**: Thos hissay (Jaise haddi, paon, sir).
2.  **Joints**: Jorr (Jaise ghutna, kohni).

**Visual vs Collision**
Robot ke har hissay ke liye hum do shaklein (shapes) batatay hain:
*   **Visual**: Dikhne mein kaisa hai. (Khubsurat). Is mein rang aur design hota hai.
*   **Collision**: Takranay ke liye. (Sada).
*   *Kyun?* Computer ke liye complex shape ka takrao hisab karna mushkil hai. Isliye hum takrao ke liye sade dibbay (boxes) ya cylinders use karte hain taake speed tez rahay.

### Pehla URDF Likhna

Apne package mein `urdf` folder banayein aur `my_robot.urdf` file likhein.

```xml
<?xml version="1.0"?>
<robot name="simple_bot">

  <!-- Base Link (Jism) -->
  <link name="base_link">
    <visual>
      <geometry>
        <box size="0.6 0.4 0.2"/>
      </geometry>
      <material name="blue">
        <color rgba="0 0 0.8 1"/>
      </material>
    </visual>
    <collision>
      <geometry>
        <box size="0.6 0.4 0.2"/>
      </geometry>
    </collision>
  </link>

  <!-- Pahiya (Wheel) -->
  <link name="right_wheel">
    <visual>
      <geometry>
        <cylinder length="0.05" radius="0.1"/>
      </geometry>
    </visual>
    <!-- Collision geometry bhi same rakhein -->
  </link>

  <!-- Joint (Jorr) -->
  <joint name="base_to_right_wheel" type="continuous">
    <parent link="base_link"/>
    <child link="right_wheel"/>
    <!-- Position: x=0, y=-0.22, z=0 -->
    <origin xyz="0 -0.22 0" rpy="1.57 0 0"/> 
    <axis xyz="0 0 1"/> <!-- Ghumne ka mehwar -->
  </joint>

</robot>
```

### Xacro (Kaam Aasaan Karna)

Agar robot ke 4 pahiye hain, to 4 baar code copy paste karna parta hai.
**Xacro** ek tareeqa hai jisme hum code ko function ki tarah likh sakte hain.

```xml
<!-- Wheel ka function banaya -->
<xacro:macro name="wheel" params="prefix location">
    <link name="${prefix}_wheel"> ... </link>
    <joint name="..."> 
        <origin xyz="0 ${location} 0" ... />
    </joint>
</xacro:macro>

<!-- Use kiya -->
<xacro:wheel prefix="right" location="-0.22"/>
<xacro:wheel prefix="left" location="0.22"/>
```
Is se ghalti ke chance kam ho jatay hain.

</Personalization>

<Personalization level="expert" language="urdu">

## Advanced Kinematics aur Inertia

**Sahi Physics Ke Liye Sahi Wazan Zaroori Hai**

Agar aap chahte hain ke simulation mein robot waisa hi chalay jaise asli dunya mein, to aap ko **Inertia** (Jmood) ka khayal rakhna parega.
Naye log aksar `<inertial>` tag chor dete hain. **Yeh mat karein.**
Physics engine (PhysX) ko $F = ma$ calculate karne ke liye mass aur inertia chahiye.

### 1. Inertia Tensor
Har link ke liye Mass ($m$) aur Inertia Matrix batana lazmi hai.

```xml
<inertial>
  <mass value="5.0"/> <!-- kg -->
  <origin xyz="0 0 0"/>
  <inertia ixx="0.1" ixy="0.0" ixz="0.0" 
           iyy="0.1" iyz="0.0" 
           izz="0.1"/>
</inertial>
```

*   **Tip**: CAD software (SolidWorks) se sahi values nikal kar yahan daalein. Andaza mat lagayein.
*   **Instability**: Agar aap ne choti cheez ko bohat bhari wazan de diya, to simulation phat sakti hai (robot hawa mein urnay lagega).

### 2. Joint Limits aur Dynamics
Humanoid robot ke jorr perfect nahi hotay.
*   **Effort**: Motor kitni taqat (Torque) laga sakti hai.
*   **Velocity**: Kitni tez ghoom sakti hai.
*   **Damping**: Ragarr (Friction). Agar ye set na karein to robot ki taang pendulum ki tarah hil ti rahegi.

```xml
<joint name="knee_joint" type="revolute">
  <limit lower="-0.1" upper="1.57" effort="30.0" velocity="5.0"/>
  <dynamics damping="0.5" friction="0.1"/>
</joint>
```

### 3. Mesh Optimization
Mechanical team se milnay wali 50MB ki `.STL` files ko seedha use na karein.
*   **Visual**: Khubsurti ke liye High-poly `.DAE` file use karein.
*   **Collision**: Physics ke liye Low-poly (Simplified) `.STL` use karein.
*   Agar aap High-poly mesh collision ke liye use karenge to Isaac Sim slow ho jayega (5 FPS).

</Personalization>

<Quiz questions={[
  {
    question: "Which geometry tag is used for physics calculations to keep simulation fast?",
    options: ["<visual>", "<collision>", "<inertial>", "<graphic>"],
    correctAnswer: 1
  },
  {
    question: "What is Xacro used for?",
    options: [
      "To run the robot faster",
      "To clean macros and reduce code duplication in URDF",
      "To visualize sensor data",
      "To install ROS 2"
    ],
    correctAnswer: 1
  },
  {
    question: "Urdu: Agar aap robot ke jorr (joint) mein 'damping' nahi lagayenge to kya hoga?",
    options: [
      "Robot jaldi chalega",
      "Robot ka hissa pendulum ki tarah hilta rahega (rukega nahi)",
      "Battery bach jayegi",
      "Robot gir jayega"
    ],
    correctAnswer: 1
  }
]} />